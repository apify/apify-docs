name: Bump OpenAPI version

on:
    push:
        branches:
            - master
        paths:
            - 'apify-api/**'

jobs:
    bump-version:
        name: Bump OpenAPI version
        runs-on: ubuntu-latest
        permissions:
            contents: write

        steps:
            - uses: actions/checkout@v6

            - name: Set up Node.js
              uses: actions/setup-node@v6
              with:
                  node-version: 24
                  cache: "npm"
                  cache-dependency-path: "package-lock.json"

            - name: Enable corepack
              run: corepack enable

            - name: Install dependencies
              run: npm ci --force
              env:
                  NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

            - name: Bump OpenAPI version
              run: node scripts/update-openapi-version.mjs

            - name: Commit version bump
              run: |
                  git config user.name "github-actions[bot]"
                  git config user.email "github-actions[bot]@users.noreply.github.com"
                  git add apify-api/openapi/openapi.yaml
                  git diff --staged --quiet || git commit -m "chore: bump OpenAPI version after spec changes"
                  git push
